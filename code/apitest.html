<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student API Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { margin: 5px; }
    input, select { margin: 5px; }
    pre { background: #f4f4f4; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Student API Tester</h1>

  <h2>Login</h2>
  <input id="user" placeholder="Email (admin@example.com or test@example.com)">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="login()">API Login (JSON)</button>
  <button onclick="webLogin()">Web Login (Redirect)</button>

  <h2>Student Actions</h2>
  <button onclick="getAll()">Get All Students</button><br>

  <input id="getId" placeholder="Student ID">
  <button onclick="getById()">Get Student by ID</button><br>

  <input id="name" placeholder="Name">
  <button onclick="getByName()">Get by Name</button><br>

  <input id="course" placeholder="Course">
  <button onclick="getByCourse()">Get by Course</button><br>

  <input id="major" placeholder="Major">
  <button onclick="getByMajor()">Get by Major</button><br>

  <input id="year" placeholder="Year">
  <button onclick="getByYear()">Get by Year</button><br>

  <h2>Create Student</h2>
  <input id="cname" placeholder="Name">
  <input id="ccourse" placeholder="Course">
  <input id="cmajor" placeholder="Major">
  <input id="cyear" placeholder="Year">
  <button onclick="createStudent()">Create</button>

  <h2>Update Student</h2>
  <input id="uid" placeholder="ID">
  <input id="uname" placeholder="Name">
  <input id="uyear" placeholder="Year">
  <button onclick="updateStudent()">Update</button>

  <h2>Delete</h2>
  <input id="did" placeholder="ID">
  <button onclick="deleteStudent()">Delete</button>
  <button onclick="deleteAll()">Delete All</button>

  <h2>Output</h2>
  <pre id="output"></pre>

  <script>
    const BASE_URL = "http://localhost:8000/api/v1";
    let authToken = null;

    async function callAPI(url, options = {}) {
      // Add authorization header if we have a token
      if (authToken) {
        options.headers = {
          ...options.headers,
          'Authorization': `Bearer ${authToken}`,
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        };
      } else if (!options.headers) {
        options.headers = {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        };
      }

      try {
        const res = await fetch(url, options);
        const text = await res.text();
        
        // Display status and response
        let output = `Status: ${res.status} ${res.statusText}\n\n`;
        
        try {
          const data = JSON.parse(text);
          output += JSON.stringify(data, null, 2);
        } catch {
          output += text;
        }
        
        document.getElementById("output").textContent = output;
        return res;
      } catch (error) {
        document.getElementById("output").textContent = `Error: ${error.message}`;
      }
    }

    async function login() {
      const email = document.getElementById("user").value;
      const password = document.getElementById("pass").value;
      
      const body = JSON.stringify({
        email: email,
        password: password
      });
      
      const res = await callAPI(`${BASE_URL}/login`, { 
        method: "POST", 
        body: body 
      });
      
      if (res && res.ok) {
        const responseText = await res.text();
        try {
          const data = JSON.parse(responseText);
          if (data.token) {
            authToken = data.token;
            document.getElementById("output").textContent += "\n\nâœ… Login successful! Token saved.";
          }
        } catch (e) {
          console.error("Failed to parse login response:", e);
        }
      }
    }

    function getAll() { 
      callAPI(`${BASE_URL}/students`); 
    }
    
    function getById() { 
      const id = document.getElementById("getId").value;
      callAPI(`${BASE_URL}/students/${id}`); 
    }
    
    function getByName() { 
      const name = document.getElementById("name").value;
      callAPI(`${BASE_URL}/students/by-name/${encodeURIComponent(name)}`); 
    }
    
    function getByCourse() { 
      const course = document.getElementById("course").value;
      callAPI(`${BASE_URL}/students/by-course/${encodeURIComponent(course)}`); 
    }
    
    function getByMajor() { 
      const major = document.getElementById("major").value;
      callAPI(`${BASE_URL}/students/by-major/${encodeURIComponent(major)}`); 
    }
    
    function getByYear() { 
      const year = document.getElementById("year").value;
      callAPI(`${BASE_URL}/students/by-year/${year}`); 
    }

    function createStudent() {
      const body = JSON.stringify({
        name: document.getElementById("cname").value,
        course: document.getElementById("ccourse").value,
        major: document.getElementById("cmajor").value,
        year: parseInt(document.getElementById("cyear").value)
      });
      callAPI(`${BASE_URL}/students`, { 
        method: "POST", 
        body: body 
      });
    }

    function updateStudent() {
      const id = document.getElementById("uid").value;
      const body = JSON.stringify({
        name: document.getElementById("uname").value,
        year: parseInt(document.getElementById("uyear").value)
      });
      callAPI(`${BASE_URL}/students/${id}`, { 
        method: "PUT", 
        body: body 
      });
    }

    function deleteStudent() {
      const id = document.getElementById("did").value;
      callAPI(`${BASE_URL}/students/${id}`, { method: "DELETE" });
    }

    function deleteAll() {
      callAPI(`${BASE_URL}/students/delete-all`, { method: "DELETE" });
    }

    // Web login - submits form to Laravel and redirects
    function webLogin() {
      const email = document.getElementById("user").value;
      const password = document.getElementById("pass").value;
      
      // Create a form and submit it to trigger web login
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = 'http://localhost:8000/login';
      
      // CSRF token (you'd need to get this from Laravel, but for demo...)
      const csrfInput = document.createElement('input');
      csrfInput.type = 'hidden';
      csrfInput.name = '_token';
      csrfInput.value = 'demo'; // In real app, get this from Laravel
      
      const emailInput = document.createElement('input');
      emailInput.type = 'hidden';
      emailInput.name = 'email';
      emailInput.value = email;
      
      const passwordInput = document.createElement('input');
      passwordInput.type = 'hidden';
      passwordInput.name = 'password';
      passwordInput.value = password;
      
      form.appendChild(csrfInput);
      form.appendChild(emailInput);
      form.appendChild(passwordInput);
      
      document.body.appendChild(form);
      form.submit();
    }
  </script>
</body>
</html>
